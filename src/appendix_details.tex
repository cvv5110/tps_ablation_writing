\newpage\appendix
\section{Technical Details}\label{appendix}

This appendix presents the technical details of the PIROM framework applied to the TPS ablation problem. The first section provides the mathematical details for the definition of the DG-FEM. The second section follows the projection procedures from Ref.\hl{x}, and demonstrates the effects of coarse-graining on the advection matrix. The third section presents the derivation of the LCM model from an energy-conservation perspective.

\subsection{Full-Order Model}

To obtain the full-order numerical solution, the governing equation is spatially discretized using variational principles of Discontinuous Galerkin (DG) to result in a high-dimensional system of ordinary differential equations (ODEs). The DG-FEM model is written in an element-wise form, which is beneficial for subsequent derivations of the lower-order models. Note that the choice of DG approach here is mainly for theoretical convenience in the subsequent coarse-graining formulation. In the numerical results, the full-order TPS ablation simulations is computed using standard FEM instead, and the equivalence between DG and standard FEM is noted upon their convergence.

\subsubsection{Domain Discretization}

Consider a conforming mesh partition of the domain, as shown in Fig.\hl{DOMAIN}, where each element belongs to one and only one component. Denote the collection of all $M$ elements as $\left\{E_i\right\}_{i=1}^{M}$. To ease the description of the DG model, a graph structure is employed. The elements are treated as vertices, the set of which is denoted $\cV=\left\{m\right\}_{m=1}^{M}$. Two neighboring elements, $E_i$ and $E_j$, are connected by an edge $(i,j)$, and the shared boundary between them is denoted $\eij$. The collection of all edges are denoted $\cE$, and $\cG$ is referred to as a graph. In the graph, the edges are unidirected, meaning if $(i,j)\in\cE$ then $(j,i)\in\cE$. Furthermore, denote the neighbors of the $i$-th element as $\cN_i=\left\{j | (i,j) \in\cE\right\}$. Lastly, for the ease of notation, introduce two special indices: $T$ for the boundary of an element that overlaps with the Dirichlet boundary condition, and similarly $q$ for the Neumann boundary condition.

\subsubsection{Weak Form of Discontinuous Galerkin Method}

Choosing appropriate basis functions $\phi_k$ and $\phi_l$ and using the Interior Penalty Galerkin (IPG) scheme ~\cite{Cohen2018}, the variational bilinear form for \cref{eqn_thermal_pde} is,
\begin{equation}
    \sum_{i=1}^{M}a_{\epsilon,i}(\phi_k,\phi_l) = \sum_{i=1}^{M}L_i(\phi_k)
\end{equation}
where $\epsilon$ is an user-specified parameter and,
\begin{subequations}
    \begin{align}
        a_{\epsilon,i}(\phi_k,\phi_l) &= \int_{E^{(i)}}\left(\rho c_p \phik \frac{\partial \phil}{\partial t} + \nabla \phik\cdot\left(\mathbf{k}\nabla \phil\right) - \rho c_p \phik \vv\cdot\nabla\phil\right)dE^{(i)}\\
        &= -\sum_{j\in\cN_i\cup\dirichletset}\int_{\eij}\average{\vk\nabla\phik\cdot n}\jump{\phil}d\eij + \epsilon\sum_{j\in\cN_i\cup\dirichletset}\int_{\eij}\average{\vk\nabla\phil\cdot n}\jump{\phik}d\eij \notag\\
        &+ \sigma\sumneighbordirichlet\int_{\eij}\jump{\phik}\jump{\phil}d\eij\\
        L_i(v) &= \epsilon\sumneighbordirichlet\int_{\eij}\left(\vk\nabla\phil\cdot n\right)T_b d\eij + \int_{\eiq}\phik q_b d\eiq + \sigma\int_{\eiT}\phik T_b d\eiT
    \end{align}
\end{subequations}
In the bi-linear form above, the notations $\jump{}$ and $\average{}$ are respectively the jumps and averages at the boundary $\eij$ share by two elements $E_i$ and $E_j$,
\[
    \jump{u} = u\big|_{E_i} - u\big|_{E_j},\quad \average{u} = \frac{1}{2}\left(u\big|_{E_i} + u\big|_{E_j}\right), \quad \text{for } x\in\eij = E_i\cap E_j
\]
Furthermore, in the bi-linear form, the terms associated with $\sigma$ are introduced to enforce the Dirichlet boundary conditions; $\sigma$ is a penalty factor whose value can depend on the size of an element. Depending on the choice of $\epsilon$, the bi-linear form corresponds to symmetric IPG ($\epsilon=-1$), non-symmetric IPG ($\epsilon=1$), and incomplete IPG ($\epsilon=0$). All these schemes are consistent with the original PDE and have similar convergence rate with respect to mesh size. In the following derivations, the case $\epsilon=0$ is chosen for the sake of simplicity.

\subsubsection{Discontinuous Galerkin Model}

Next, the DG-based model is written in an element-wise form. For the $i$-th element, use a set of $P$ trial functions to represent the temperature as in \cref{eqn_element_temperature}. Without loss of generality, the trial functions are assumed to be orthogonal, so that $\int_{E^{(i)}} \phii_k(x) \phii_l(x) dx = \left|\Ei\right|\delta_{kl}$, where $\left|\Ei\right|$ is the area $(n_d=2)$ or volume $(n_d=3)$ of the $i$-th element, and $\delta_{kl}$ is the Kronecker delta.

Using test functions same as trial functions, the dynamics $\vu^{(i)}$ is obtained by evaluating the element-wise bi-linear forms,
\begin{equation}
    a_{\epsilon,i}(\phik^{(i)},T^{(i)}) = L_i(\phik^{(i)}),\quad k=1,2,\dots,P
\end{equation}
The above procedure yields,
\begin{equation}
    \vA^{(i)}\dot{\vu}^{(i)} = \left(\vB^{(i)} + \vC^{(i)}(t)\right)\vui + \sumneighbordirichlet\left(\vB^{(i)}_{ij}\vui + \vB^{(j)}_{ij}\vuj\right) + \vf^{(i)}(t)\label{eqn_element_wise_model}
\end{equation}
where for $k,l=1,2,\dots,P$,
\begin{subequations}
    \begin{align}
        \left[\vA^{(i)}\right]_{kl} &= \intEi\rho c_p\phik^{(i)}\phil^{(i)}d\Ei\\
        \left[\vB^{(i)}\right]_{kl} &= -\intEi\left(\nabla\phik^{(i)}\right)\cdot\left(\vk\nabla\phil^{(i)}\right)d\Ei\\
        \left[\vC^{(i)}\right]_{kl} &= \intEi\rho c_p \phik^{(i)}\vv^{(i)}\cdot\nabla\phil^{(i)}d\Ei\label{eqn_advection_matrix_element_kl}\\
        \left[\vBi_{ij}\right] &= \int_{\eij}\average{\vk\nabla\phik^{(i)}\cdot\hat{n}}\phil^{(i)} - \sigma\jump{\phik^{(i)}}\phil^{(i)}d\eij\\
        \left[\vBj_{ij}\right] &= \int_{\eij}-\average{\vk\nabla\phik^{(i)}\cdot\hat{n}}\phil^{(j)} + \sigma\jump{\phik^{(i)}}\phil^{(j)}d\eij\\
        \left[\vf^{(i)}\right]_k &= \int_{\eiq}\phik^{(i)}q_bd\eiq + \sigma\int_{\eiT}\phik^{(i)}d\eiT
    \end{align}
\end{subequations}
The matrices $\vA^{(i)}\in\mathbb{R}^{P\times P}$, $\vB^{(i)}\in\mathbb{R}^{P\times P}$, and $\vC^{(i)}\in\mathbb{R}^{P\times P}$ are respectively the capacitance, conductivity, and advection matrices for element $i$. These matrices depend on $\rho$, $c_p$, $\vk$, and $\vv$, and hence can be non-linear functions of $\vu^{(i)}$. Since the trial functions are orthogonal, if $\rho c_p$ is constant within an element, $\vAi$ is diagonal; otherwise, $\vA_i$ is symmetric and positive definite as $\rho c_p > 0$.

For compactness, the element-wise model in \cref{eqn_element_wise_model} is also written in matrix form,
\begin{equation}
    \vA(\dot{\vu}) = \left[\vB(\vu) + \vC(\vu)\right]\vu + \mathbf{f}(t)\label{eqn_complete_model}
\end{equation}
where $\vu = \left[\vu^{(1)},\vu^{(2)},\cdots,\vu^{(M)}\right]^T\in\mathbb{R}^{MP}$ includes all DG variables, $\vf=\left[\vf^{(1)},\vf^{(2)},\dots,\vf^{(M)}\right]^T\in\mathbb{R}^{MP}$, $\vA$ and $\vC$ are matrices of $M$ diagonal blocks whose $i$-th blocks are $\vAi$ and $\vCi$, and $\vB$ is a matrix of $M\times M$ blocks whose $(i,j)$-th block is,
\begin{equation}
    \vB_{ij} = \begin{cases}
            \vBi + \sumneighbordirichlet\vBi_{ij}, & i=j\\
            \vBj_{ij}, & i\neq j
        \end{cases}
\end{equation}
The dependency of $\vA$, $\vB$, and $\vC$ on $\vu$ is explicitly noted in \cref{eqn_complete_model}, which is the source of non-linearity in the current TPS problem. Moreover, the mesh velocity $\vv$ varies with space and time, and thus the advection matrix $\vC$ varies with time as a function of $q_b$.

\subsection{Coarse-Graining of Dynamics}

The LCM is obtained by coarse-graining the full-order DG-FEM. This coarse-graining procedure produces resolved $\vr^{(1)}(\vu,t)$ and residual $\vr^{(2)}(\vu,t)$ dynamics as in \cref{eqn_coarse_grained_dynamics}. This section presents the detail derivations and magnitude analysis for the resolved and residual dynamics.

\subsubsection{Resolved Dynamics}

Using \cref{eqn_projection_operator}, the resolved dynamics is computed as follows,
\begin{subequations}
    \begin{align}
        &\vr^{(1)}(\vu,t) = 
        \cP\left[\vPhiplus\vA(\vu)^{-1}\left(\vB(\vu)\vu + \vC(\vu)\vu + \vf(t)\right)\right]\\[4pt]
        &\begin{array}{rl}
            =\vPhiplus\vA\left(\vP\vu\right)^{-1}\vP\vB\left(\vP\vu\right)\vP\vu
            &+~\vPhiplus\vA\left(\vP\vu\right)^{-1}\vP\vC\left(\vP\vu\right)\vP\vu \\[6pt]
            &+~\vPhiplus\vA\left(\vP\vu\right)^{-1}\vP\vf(t,\vP\vu)
        \end{array}\\[4pt]
        &\begin{array}{rl}
            =\underbrace{\vPhiplus\vA\left(\vPhi\bvu\right)^{-1}\vPhi}_{\text{\#1}}
            \underbrace{\vPhiplus\vB\left(\vPhi\bvu\right)\vPhi\bvu}_{\text{\#2}}
            &+~\vPhiplus\vA\left(\vPhi\bvu\right)^{-1}\vPhi
            \underbrace{\vPhiplus\vC\left(\vPhi\bvu\right)\vPhi}_{\text{\#3}}\bvu \\[6pt]
            &+~\vPhiplus\vA\left(\vPhi\bvu\right)^{-1}\vPhi
            \underbrace{\vPhiplus\vf(t,\vPhi\bvu)}_{\text{\#4}}
        \end{array}
    \end{align}
\end{subequations}
Detailed derivations for the \#1, \#2, and \#4 terms can be found in Ref.\hl{x}. The effects of coarse-graining on the advection term \#3 are analyzed next.

\paragraph*{\textit{Term \#3}} The $\vC(\vu)\in\mathbb{R}^{MP\times MP}$ matrix contains $M$ diagonal of size $P\times P$, since the basis functions are defined locally on each element. Therefore, $\left[\vC(\vu)\right]_{ij} = \vzero$ for all $i \neq j$ with $i,j=1,2,\dots,M$. It follows that for $k,l=1,2,\cdots,N$,
\begin{subequations}
    \begin{align}
        \left[\vPhiplus\vC(t,\vPhi\bvu)\vPhi\right]_{kl} &= \sum_{i=1}^{M}\sum_{j=1}^{M}\vvarphi_{i}^{k+}\left[\vC(t,\vPhi\bvu)\right]_{ij}\vvarphi_{j}^{l}\\
        &= \sum_{i=1}^{M}\vvarphi_{i}^{k+}\left[\vC(t,\vPhi\bvu)\right]_{ii}\vvarphi_{i}^{l}\\
        &= \sum_{i\in\cV_k} \vvarphi_{i}^{k+}\left[\vC(t,\vPhi\bvu)\right]_{ii}\vvarphi_{i}^{l}
    \end{align}
\end{subequations}
where in the second row, the fact that $\left[\vC(\vu)\right]_{ij} = 0$ for all $i\neq j$ is used, and in the last row, the fact that $\vvarphi_{i}^{k+}=0$ for all $i\notin\cV_k$ is used. Now, considering that $\left[\vC(\vu)\right]_{ii}$ has a $(1,1)$-th zero element, i.e., $\left[C_{11}(t,\vPhi\bvu)\right]_{ii} = 0$, and that if $k\neq l$ then $i\notin\cV_l$ and thus $\vvarphi_i^{l}=\vzero$, it follows that for some index $i\in\cV_k$,
\begin{equation}
    \vvarphi_{i}^{k+}\left[\vC(t,\vPhi\bvu)\right]_{ii}\vvarphi_{i}^{l} = \vvarphi_{i}^{k+}\left[\vC(t,\vPhi\bvu)\right]_{ii}\vvarphi_{i}^{k} = \frac{|E_i|}{|\Omega_k|}\left[C_{11}(t,\vPhi\bvu)\right]_{ii} = 0
\end{equation}
The matrix $\left[\vPhiplus\vC(t,\vPhi\bvu)\vPhi\right]_{kl} = 0$ for all $k,l=1,2,\dots,N$, and thus,
\begin{equation}
    \bvC\left(t,\bvu\right) = \vPhiplus\vC\left(t,\vPhi\bvu\right)\vPhi = \vzero
\end{equation}
as indicated by the LCM in \cref{eqn_lcm}.

\subsubsection{Magnitude Analysis for Residual Dynamics}

Next, the magnitude of the residual dynamics $\vr^{(2)}(\vu,t)$ is analyzed to pinpoint the missing physics in the LCM. By definition,
\begin{subequations}
\begin{align}
    \vr^{(2)}(\vu,t) &= \dot{\bvu} - \vr^{(1)}(\bvu,t) \\ 
    &= \vPhiplus\vr(\vu,t) - \vr^{(1)}(\vu,t)\\
    &= \begin{array}[t]{@{}l@{\;}c@{\;}l@{}}
       \underbrace{\vPhiplus\vA(\vu)^{-1}\vB(\vu)\vu - \bvA(\bvu)^{-1}\bvB(\bvu)\bvu}_{\text{\#1}}
       & + &
       \underbrace{\vPhiplus\vA(\vu)^{-1}\vC(\vu)\vu - \bvA(\bvu)^{-1}\bvC(t,\bvu)\bvu}_{\text{\#2}} \\
       & + &
       \underbrace{\vPhiplus\vA(\vu)^{-1}\vf(t) - \bvA(\bvu)^{-1}\bvf(t)}_{\text{\#3}}
       \end{array}
\end{align}
\end{subequations}
The magnitude analysis for terms \#1 and \#3 can be found in Ref.\hl{x}. The analysis for term \#2 is presented next. Let $\vD(\bvu) = \vA(\vPhi\bvu)^{-1}\vP\vC(t,\vPhi\bvu)$, then,
\begin{subequations}
    \begin{align}
        &\vPhiplus\vA(\vu)^{-1}\vC(\vu)\vu - \bvA(\bvu)^{-1}\bvC(t,\bvu)\bvu\\
        &= \vPhiplus\vA(\vu)^{-1}\vC(\vu)\vu - \vPhiplus\vA(\vPhi\bvu)^{-1}\vP\vC(t,\vPhi\bvu)\vPhi\vPhiplus\vu\\
        &= \vPhiplus\vA^{-1}(\vu)\vC(\vu)\vu - \vPhiplus\vD(\bvu)\vPhi\vPhiplus\vu\\
    \end{align}
\end{subequations}
where $\vP=\vPhi\vPhiplus$. Thus,
\begin{subequations}
    \begin{align}
        &\left\|\vPhiplus\vA(\vu)^{-1}\vC(\vu)\vu - \bvA^{-1}(\bvu)\bvC(t,\bvu)\bvu\right\| \\
        &\leq \left\|\vPhiplus\vA^{-1}(\vu)\vC(\vu)\vu - \vPhiplus\vD(\bvu)\vu\right\| + \left\|\vPhiplus\vD(\bvu)\vu - \vPhiplus\vD(\bvu)\vPhi\vPhiplus\vu\right\|\\
        &\leq \left\|\vPhiplus\right\|\underbrace{\left\|\vA^{-1}(\vu)\vC(\vu)\vu - \vD(\bvu)\vu\right\|}_{\#1} + \left\|\vPhiplus\vD(\bvu)\right\|\underbrace{\left\|\vu - \vPhi\vPhiplus\vu\right\|}_{\#2}
    \end{align}
\end{subequations}
where term \#2 is due to the appriximation of non-uniform temperaeture as constants, and term \#1 is the error in the advection dynamics due to coarse-graining. 

\subsection{Lumped Capacitance Model}

The following assumptions are employed: (1) the temperature in component $(i)$ is described by a scalar time-varying average temperature $\bar{u}^{(i)}$, (2) between neighboring components $(i)$ and $(j)$ the heat flux is approximated as,
\begin{equation}
    q_{ij} = \frac{\baruj - \barui}{R_{ij}}
\end{equation}
where $R_{ij}$ is the thermal resistance. Empirically, for a component of isotropic heat conductivity $k$, length $\ell$, and cross-section area $A$, the thermal resistance is $R=\ell/kA$. Between components $i$ and $j$, define $R_{ij}=R_{i} + R_{j}$. In addition, the heat flux due to Dirichlet boundary condition is computed as $q_{iT} = (T_b - \barui)/R_{i}$.

At component $i$, the dynamics of LCM are given by,
\begin{subequations}
    \begin{align}
        \int_{\Ei}\rho c_p \dot{\bar{u}}^{(i)} d\Ei &= \left(\sumneighbori\int_{\eij}\frac{\baruj - \barui}{R_{ij}}d\eij\right) + \int_{\eiq} q_b d\eiq + \int_{\eiT}\frac{T_b - \barui}{R_i}d\eiT\label{eqn_lcm_1}\\
        \bar{A}^{(i)}\dot{\bar{u}}^{(i)} &= \left(\sumneighbori\frac{|\eij|}{R_{ij}}\left(\baruj - \barui\right)\right) + |\eiq|\bar{q}^{(i)} + \frac{|\eiT|}{R_i}\left(\bar{T}^{(i)} - \barui\right) \label{eqn_lcm_2}\\ 
        &= \sumneighbori\left(-\frac{|\eij|}{R_{ij}}\barui + \frac{|\eij|}{R_{ij}}\baruj\right) + \left(-\frac{|\eiT|}{R_{i}}\barui\right) + \left(|\eiq|\bar{q}^{(i)} + \frac{|\eiT|}{R_i}\bar{T}^{(i)}\right)\label{eqn_lcm_3}\\
        &= \sumneighbordirichlet\left(\bar{B}^{(i)}_{ij}\barui + \bar{B}^{(j)}_{ij}\baruj\right) + \bar{f}^{(i)}\label{eqn_lcm_4}
    \end{align}
\end{subequations}
where in \cref{eqn_lcm_2} $|e|$ denotes the length $(d=2)$ or area $(d=3)$ of a component boundary $e$. The $\bar{A}^{(i)}$, $\bar{B}_{ij}^{(i)}$, and $\bar{B}_{ij}^{(j)}$ quantities are provided in \cref{eqn_lcm_matrices_elements}.

The lumped-mass representation for the four-component TPS is shown in Fig.~\ref{fig_four_components}. Let $v_i$ represent the area of the $i$-th element, $\overline{\rho c_p}_{,i}$, the heat capacity evaluated using the average temperature $\bu^{(i)}$, and $1/R_{ij} = 1/R_{i}(\bu^{(i)}) + 1/R_{j}(\bu^{(j)})$ the equivalent thermal resistance between elements $i$ and $j$. Leveraging the formulas from \cref{eqn_lcm_matrices,eqn_lcm_matrices_elements}, the LCM matrices are given by,
\begin{subequations}
    \begin{gather}
        \bar{\vA} = \begin{bmatrix}
            \overline{\rho c_p}_{,1} v_1 & 0 & 0 & 0\\
            0 & \overline{\rho c_p}_{,2} v_2 & 0 & 0\\
            0 & 0 & \overline{\rho c_p}_{,3} v_3 & 0\\
            0 & 0 & 0 & \overline{\rho c_p}_{,4} v_4
        \end{bmatrix},\\
        \bar{\vB} = \begin{bmatrix}
            \frac{1}{R_{12}} + \frac{1}{R_{14}} & -\frac{1}{R_{12}} & 0 & -\frac{1}{R_{14}}\\
            -\frac{1}{R_{12}} & \frac{1}{R_{12}} + \frac{1}{R_{24}} + \frac{1}{R_{23}} & -\frac{1}{R_{23}} & -\frac{1}{R_{24}}\\
            0 & -\frac{1}{R_{32}} & \frac{1}{R_{32}} + \frac{1}{R_{34}} & -\frac{1}{R_{34}}\\
            -\frac{1}{R_{14}} & -\frac{1}{R_{24}} & -\frac{1}{R_{34}} & \frac{1}{R_{14}} + \frac{1}{R_{24}} + \frac{1}{R_{34}}
        \end{bmatrix},\quad \bar{\vf} = \begin{bmatrix}
            \bar{q}^{(1)} \\
            \bar{q}^{(2)} \\
            \bar{q}^{(3)} \\
            0
        \end{bmatrix}
    \end{gather}
\end{subequations}


